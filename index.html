<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0A0A0A">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Daily Tasks">
  <link rel="manifest" href="/dailytaskapp/manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>Daily Task App</title>

  <!-- Modern type + smooth text rendering -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    /* =========================
       THEME TOKENS (Brand vibe)
       ========================= */
    :root{
      --ink:#0A0A0A;           /* deep black */
      --cream:#F8EDCC;         /* warm cream */
      --gold:#CBA135;          /* luxe gold */
      --card: rgba(255,255,255,0.75);
      --stroke: rgba(10,10,10,0.08);
      --muted:#5f5f5f;
      --good:#66B032;
      --accent: var(--gold);
      --bg-grad: radial-gradient(1200px 900px at 10% 10%, rgba(203,161,53,0.16), transparent 50%),
                 radial-gradient(900px 900px at 90% 0%, rgba(248,237,204,0.35), transparent 60%),
                 radial-gradient(700px 700px at 50% 100%, rgba(10,10,10,0.6), rgba(10,10,10,0.9));
      --card-blur: saturate(140%) blur(8px);
      --radius-xl: 20px;
      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-soft: 0 10px 30px rgba(0,0,0,0.12);
      --shadow-hover: 0 14px 40px rgba(0,0,0,0.18);
      --ring: 2px solid rgba(203,161,53,0.35);
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg-grad:
          radial-gradient(1200px 900px at 10% 10%, rgba(203,161,53,0.12), transparent 50%),
          radial-gradient(900px 900px at 90% 0%, rgba(248,237,204,0.6), transparent 60%),
          linear-gradient(180deg, #ffffff, #faf8f2);
        --ink:#121212;
        --card: rgba(255,255,255,0.85);
        --stroke: rgba(0,0,0,0.06);
      }
    }

    /* ============ Base ============ */
    *{box-sizing:border-box}
    html, body{
      margin:0; padding:0; height:100%; width:100%;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      background: var(--bg-grad);
      color: var(--ink);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    body{
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    .container{ max-width: 980px; margin: 0 auto; padding: clamp(16px, 3vw, 28px); }

    /* ============ Header ============ */
    header{
      position:relative;
      border-radius: var(--radius-xl);
      padding: clamp(16px, 3vw, 28px);
      background: var(--card);
      backdrop-filter: var(--card-blur);
      -webkit-backdrop-filter: var(--card-blur);
      box-shadow: var(--shadow-soft);
      border:1px solid var(--stroke);
      overflow:hidden;
    }
    header::after{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 120px at 50% 0%, rgba(203,161,53,0.25), transparent 60%);
      pointer-events:none;
    }
    header img{ width:64px; height:64px; object-fit:contain; display:block; margin: 0 auto 8px; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.2)); }
    .day-heading{
      text-align:center;
      font-weight:800;
      font-size: clamp(28px, 4.8vw, 42px);
      letter-spacing:.2px;
      margin: 4px 0 10px;
      background: linear-gradient(100deg, var(--ink), var(--gold));
      -webkit-background-clip: text;
      background-clip:text;
      color: transparent;
    }
    .weather-content{
      display:flex; flex-direction:column; align-items:center; gap:4px;
      font-size: 0.98rem; color: var(--ink);
      opacity:.9;
    }
    .weather-content .temp{ font-weight:700; font-size:1.15rem }
    .weather-content .desc{ font-style: italic; color: var(--muted) }

    #affirmation-box{
      text-align:center; margin-top:10px; font-style:italic; opacity:0;
      transition: opacity .9s ease;
      font-size: clamp(0.95rem, 1.2vw, 1.05rem);
      color: var(--ink);
    }
    #affirmation-box.visible{ opacity:1 }

    /* ============ Sticky Day Nav ============ */
    .day-nav{
      position: sticky; top: 8px; z-index: 999;
      margin: 18px 0 10px;
      display:flex; justify-content:center; gap:8px; flex-wrap:wrap;
      padding: 8px;
      background: rgba(255,255,255,0.55);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      border:1px solid var(--stroke);
      border-radius: 999px;
      box-shadow: var(--shadow-soft);
    }
    .day-nav a{
      text-decoration:none;
      color: var(--ink);
      padding: 8px 14px;
      border-radius: 999px;
      border:1px solid transparent;
      font-weight: 600;
      font-size:.95rem;
      transition: transform .18s ease, box-shadow .18s ease, background .2s;
      background: rgba(248,237,204,0.55);
    }
    .day-nav a:hover{ transform: translateY(-1px); box-shadow: var(--shadow-soft) }
    .day-nav a:active{ transform: translateY(0) scale(.98) }
    
    /* ======= Section Title Pills ======= */
    .pill-title{
      text-align:center;
      margin: 28px auto 8px;
      width: fit-content;
      padding: 8px 16px;
      font-weight: 700;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.55));
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      box-shadow: var(--shadow-soft);
    }

    /* ============ Cards Grid ============ */
    .journal-grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: clamp(16px, 2.2vw, 24px);
      margin-top: 18px;
    }
    section#journals, section#gratitude{
      grid-column: span 6;
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      backdrop-filter: var(--card-blur);
      -webkit-backdrop-filter: var(--card-blur);
      padding: clamp(16px, 2vw, 22px);
    }
    @media (max-width: 860px){
      section#journals, section#gratitude{ grid-column: 1 / -1 }
    }
    section#journals h2, section#gratitude h2{
      margin: 2px 0 8px; font-size: 1.05rem; font-weight: 700; letter-spacing:.2px;
      color: var(--ink);
    }
    section#journals textarea, section#gratitude textarea{
      width: 100%; min-height: 120px;
      padding: 12px 14px;
      font-family: Inter, Arial, sans-serif; font-size: 0.98rem; line-height: 1.45;
      border-radius: var(--radius-lg);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,0.9);
      outline: none;
      transition: box-shadow .2s ease, border-color .2s ease;
    }
    section#journals textarea:focus, section#gratitude textarea:focus{
      border-color: rgba(203,161,53,0.45);
      box-shadow: 0 0 0 4px rgba(203,161,53,0.16);
    }

    /* Primary buttons */
    button, .btn{
      appearance:none; -webkit-appearance:none;
      border:none; cursor:pointer; user-select:none;
      border-radius: 999px;
      padding: 10px 16px;
      font-weight: 700; font-size: .98rem;
      color: #111;
      background: linear-gradient(180deg, #FFD261, #E8B94A);
      box-shadow: 0 6px 14px rgba(203,161,53,0.28), inset 0 1px 0 rgba(255,255,255,0.6);
      transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
    }
    button:hover{ transform: translateY(-1px); box-shadow: 0 10px 20px rgba(203,161,53,0.36) }
    button:active{ transform: translateY(0) scale(.98) }

    #save-journal-btn{ display:block; margin: 12px 0 0 auto; }

    /* ============ Mood Picker ============ */
    #mood{ display:none } /* keep legacy select hidden */
    .mood-grid{ display:flex; flex-wrap:wrap; gap:10px; justify-content:flex-start; }
    .mood-chip{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,0.85);
      padding: 10px 14px;
      border-radius: 14px;
      font-size: 1.35rem;
      line-height:1;
      box-shadow: var(--shadow-soft);
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
    }
    .mood-chip:hover{ transform: translateY(-1px); box-shadow: var(--shadow-hover) }
    .mood-chip[aria-checked="true"]{
      outline: none; border:1px solid rgba(203,161,53,0.5);
      background: linear-gradient(180deg, rgba(248,237,204,0.9), rgba(255,255,255,0.85));
      box-shadow: 0 0 0 4px rgba(203,161,53,0.18), var(--shadow-soft);
    }
    .mood-live{
      display:flex; align-items:center; gap:10px; justify-content:flex-start; margin-top:6px;
      font-weight:600; color: var(--ink);
    }
    .mood-label{ font-weight:600; color: var(--muted) }

    /* ============ Breathing ============ */
    #breathing .breathing-tile{
      max-width: 720px; margin: 22px auto;
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      backdrop-filter: var(--card-blur);
      -webkit-backdrop-filter: var(--card-blur);
      padding: clamp(18px, 3vw, 28px);
    }
    #breath-bubble-container{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap: 18px;
      padding: 10px 8px 8px;
    }
    /* bubble never bleeds out */
    #breath-bubble{
      width: clamp(160px, 28vw, 220px);
      height: clamp(160px, 28vw, 220px);
      border-radius: 50%;
      background: radial-gradient(circle at 40% 30%, #ffffff, #CFE7FF 45%, #9EC9FF 70%, #5FA8FF 100%);
      box-shadow: 0 15px 40px rgba(95,168,255,0.35), inset 0 -6px 16px rgba(0,0,0,0.12);
      transform-origin:center;
      will-change: transform;
    }
    #breath-text{
      font-size: clamp(18px, 2.6vw, 22px);
      font-weight: 700;
      color: var(--ink);
      display:flex; align-items:baseline; gap:8px;
    }
    #breath-text #countdown{ font-size: 1.4em; color: var(--good) }
    @keyframes breathe { 0%, 100% { transform: scale(1) } 50% { transform: scale(1.35) } }
    .breathe-animation{ animation: breathe 8s ease-in-out infinite } /* smoother & a touch slower */

    /* ============ Progress Ring ============ */
    .section-label{
      text-align:center; font-weight:800; color: var(--ink);
      margin: 38px 0 6px; letter-spacing:.2px;
    }
    #progress-ring-container{
      display:flex; justify-content:center; align-items:center; margin: 8px auto;
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius-xl);
      padding: 16px;
      width: fit-content;
      box-shadow: var(--shadow-soft);
      backdrop-filter: var(--card-blur);
      -webkit-backdrop-filter: var(--card-blur);
    }
    #progress-ring{ transform: rotate(-90deg); overflow:visible; }
    #progress-ring-bar{ transition: stroke-dashoffset .4s ease }
    #progress-text{
      text-align:center; font-weight:800; letter-spacing:.3px; margin: 10px 0 6px;
      background: linear-gradient(100deg, var(--ink), var(--gold));
      -webkit-background-clip:text; background-clip:text; color: transparent;
    }

    /* ============ Tasks ============ */
    #task-list{
      margin: 12px auto 2px; max-width: 760px;
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius-xl);
      padding: 12px;
      box-shadow: var(--shadow-soft);
      min-height: 10px;
    }
    .task-input-group{
      display:flex; gap: 10px; flex-wrap: wrap; justify-content:center;
      margin: 14px auto 10px; max-width: 760px;
    }
    #new-task{
      flex: 1 1 380px; max-width: 520px; min-width: 220px;
      padding: 12px 14px; border-radius: 999px; border:1px solid var(--stroke);
      outline:none; font-size: 1rem; background: rgba(255,255,255,0.92);
      transition: box-shadow .2s ease, border-color .2s ease;
    }
    #new-task:focus{ border-color: rgba(203,161,53,0.45); box-shadow: 0 0 0 4px rgba(203,161,53,0.16) }

    /* ============ Quote Footer ============ */
    footer#quote-footer{
      margin: 22px 0 6px;
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius-xl);
      padding: 16px 18px;
      text-align:center; color: var(--ink);
      font-style: italic;
      box-shadow: var(--shadow-soft);
      backdrop-filter: var(--card-blur);
      -webkit-backdrop-filter: var(--card-blur);
    }
    #quote-box{ margin: 0; opacity:.9 }

    /* ======= Hidden legacy placeholders ======= */
    .compat-hidden{ display:none !important; visibility:hidden !important; }

    /* ======= Motion sensitivity ======= */
    @media (prefers-reduced-motion: reduce){
      .breathe-animation{ animation-duration: 14s }
      .day-nav a:hover, button:hover{ transform:none }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="apple-touch-icon.png" alt="App Logo">
      <h1 id="page-title" class="day-heading"></h1>
      <div id="weather" class="weather-content"></div>
      <div id="affirmation-box"></div>
    </header>

    <nav class="day-nav" aria-label="Select day">
      <a href="?day=Monday">Mon</a><a href="?day=Tuesday">Tue</a><a href="?day=Wednesday">Wed</a>
      <a href="?day=Thursday">Thu</a><a href="?day=Friday">Fri</a><a href="?day=Saturday">Sat</a><a href="?day=Sunday">Sun</a>
    </nav>

    <div class="pill-title">🧘 Mindfulness Zone</div>
    <div class="journal-grid">
      <section id="journals">
        <h2>Dream Journal</h2>
        <textarea id="dream-journal" placeholder="What did you notice in your dreams?"></textarea>

        <h2>Daily Journal</h2>
        <textarea id="daily-journal" placeholder="Let it out. One thought, one breath, one day at a time."></textarea>

        <button id="save-journal-btn">Save Journals</button>
      </section>

      <section id="gratitude">
        <h2>Gratitude Prompt</h2>
        <textarea id="gratitudeEntry" placeholder="Today I’m grateful for…"></textarea>

        <h2>Your Mood</h2>
        <!-- Hidden legacy select (kept for compatibility) -->
        <select id="mood">
          <option value="">How do you feel?</option>
          <option value="😀">Happy</option>
          <option value="😐">Neutral</option>
          <option value="😔">Sad</option>
          <option value="😤">Frustrated</option>
          <option value="😴">Tired</option>
          <option value="😌">Peaceful</option>
        </select>

        <!-- Emoji chips -->
        <div class="mood-grid" role="radiogroup" aria-label="Mood picker">
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😔" data-label="Sad">😔</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😤" data-label="Frustrated">😤</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😐" data-label="Neutral">😐</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="🙂" data-label="Okay">🙂</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😀" data-label="Happy">😀</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😌" data-label="Peaceful">😌</button>
        </div>

        <div class="mood-live">
          <span id="mood-emoji" style="font-size:2rem; opacity:.5;">—</span>
          <span id="mood-label" class="mood-label" style="opacity:.7;">How do you feel?</span>
        </div>
      </section>
    </div>

    <section id="breathing">
      <div class="pill-title">Breathing Exercise</div>
      <div class="breathing-tile">
        <div id="breath-bubble-container">
          <div id="breath-bubble"></div>
          <p id="breath-text">Inhale for <span id="countdown">4</span></p>
          <button id="breath-toggle-btn">Start Breath</button>
        </div>
      </div>
    </section>

    <h2 class="section-label">🌱 Today’s Tasks</h2>
    <div id="progress-ring-container" aria-label="Task progress">
      <svg id="progress-ring" width="160" height="160" role="img" aria-label="Progress ring">
        <defs>
          <linearGradient id="grad" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#F8EDCC"></stop>
            <stop offset="60%" stop-color="#CBA135"></stop>
            <stop offset="100%" stop-color="#7A5B1F"></stop>
          </linearGradient>
        </defs>
        <circle stroke="#e8e6df" stroke-width="12" fill="transparent" r="68" cx="80" cy="80"></circle>
        <circle id="progress-ring-bar" stroke="url(#grad)" stroke-width="12" fill="transparent" r="68" cx="80" cy="80" stroke-linecap="round" stroke-dasharray="427" stroke-dashoffset="427"></circle>
      </svg>
    </div>
    <p id="progress-text">0% Complete</p>

    <div id="task-list"></div>
    <div class="task-input-group">
      <input type="text" id="new-task" placeholder="Add a new task…">
      <button onclick="addTask()">Add Task</button>
      <button onclick="resetTasks()">Reset All Tasks</button>
    </div>

    <footer id="quote-footer"><p id="quote-box">Loading quote...</p></footer>
  </div>

  <!-- Legacy/compat placeholders (hidden) -->
  <div class="compat-hidden">
    <div id="progress-container"><div id="progress-bar"></div></div>
    <h2 class="section-label">♾ Ongoing Tasks</h2>
    <div id="ongoing-task-list"></div>
    <div class="task-input-group">
      <input type="text" id="new-ongoing-task" placeholder="Add new ongoing task">
      <button id="add-ongoing-task-btn">Add Task</button>
      <button id="reset-ongoing-tasks-btn">Reset Ongoing Tasks</button>
    </div>
  </div>

  <!-- Guards for legacy calls -->
  <script>
    window.addOngoingTask = window.addOngoingTask || function(){};
    window.resetOngoingTasks = window.resetOngoingTasks || function(){};
    window.updateLegacyProgress = window.updateLegacyProgress || function(pct){
      const bar = document.getElementById('progress-bar');
      if (bar) bar.style.width = (Number(pct)||0) + '%';
    };
  </script>

  <!-- Progress ring helper (updated circumference for r=68) -->
  <script>
    (function () {
      const radius = 68;
      const circumference = 2 * Math.PI * radius; // ~427
      window.updateProgressCircle = function (percent) {
        const pct = Math.max(0, Math.min(100, Number(percent) || 0));
        const circle = document.getElementById('progress-ring-bar');
        if (!circle) return;
        const offset = circumference - (pct / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        const label = document.getElementById('progress-text');
        if (label) label.textContent = `${pct}% Complete`;
      };
    })();
  </script>

  <!-- Mood control behavior (unchanged logic; modern visuals) -->
  <script>
    (function () {
      const moodSelect = document.getElementById("mood");
      const chips = Array.from(document.querySelectorAll(".mood-chip"));
      const liveEmoji = document.getElementById("mood-emoji");
      const liveLabel = document.getElementById("mood-label");

      function clearSelection() {
        chips.forEach(c => c.setAttribute("aria-checked", "false"));
        if (moodSelect) moodSelect.value = "";
        if (liveEmoji) { liveEmoji.textContent = "—"; liveEmoji.style.opacity = ".5"; }
        if (liveLabel) { liveLabel.textContent = "How do you feel?"; liveLabel.style.opacity = ".7"; liveLabel.style.color = ""; }
      }
      function setSelection(emoji, label) {
        chips.forEach(c => c.setAttribute("aria-checked", c.dataset.emoji === emoji ? "true" : "false"));
        if (moodSelect) moodSelect.value = emoji;
        if (liveEmoji) { liveEmoji.textContent = emoji; liveEmoji.style.opacity = "1"; }
        if (liveLabel) { liveLabel.textContent = label; liveLabel.style.opacity = "1"; liveLabel.style.color = "var(--ink)"; }
      }

      const prefill = moodSelect?.value || "";
      if (prefill) {
        const chip = chips.find(c => c.dataset.emoji === prefill);
        if (chip) setSelection(chip.dataset.emoji, chip.dataset.label);
        else clearSelection();
      } else {
        clearSelection();
      }

      chips.forEach(chip => {
        chip.addEventListener("click", () => setSelection(chip.dataset.emoji, chip.dataset.label));
        chip.addEventListener("keydown", (e) => {
          if (e.key === " " || e.key === "Enter") {
            e.preventDefault();
            setSelection(chip.dataset.emoji, chip.dataset.label);
          }
        });
      });
    })();
  </script>

  <!-- Optional: gentler default for breathing bubble timing if main.js doesn't override -->
  <script>
    (function(){
      const bubble = document.getElementById('breath-bubble');
      const toggle = document.getElementById('breath-toggle-btn');
      const text = document.getElementById('breath-text');
      const count = document.getElementById('countdown');

      let running = false;
      let phaseIndex = 0; // 0: inhale, 1: hold, 2: exhale, 3: hold
      let timer;

      function setPhase(i){
        phaseIndex = i % 4;
        const phases = [
          {label:'Inhale for', sec:4, animate:true},
          {label:'Hold for', sec:4, animate:false},
          {label:'Exhale for', sec:4, animate:false},
          {label:'Hold for', sec:4, animate:false}
        ];
        const p = phases[phaseIndex];
        text.firstChild.nodeValue = p.label + ' ';
        count.textContent = p.sec;
        bubble.classList.toggle('breathe-animation', p.animate);
      }

      function tick(){
        let n = parseInt(count.textContent, 10);
        if (isNaN(n)) n = 4;
        if (n > 1){
          count.textContent = n - 1;
        } else {
          setPhase(phaseIndex + 1);
        }
      }

      function start(){
        if (running) return;
        running = true;
        toggle.textContent = 'Pause';
        setPhase(0);
        timer = setInterval(tick, 1000);
      }
      function pause(){
        running = false;
        toggle.textContent = 'Resume';
        clearInterval(timer);
        bubble.classList.remove('breathe-animation');
      }
      toggle?.addEventListener('click', () => running ? pause() : start());
    })();
  </script>

  <!-- Your app logic -->
  <script type="module" src="main.js"></script>
</body>
</html>
