<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0e1014">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Daily Tasks">
  <link rel="manifest" href="/dailytaskapp/manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>Daily Task App</title>

  <style>
    /* ====== Design Tokens ====== */
    :root {
      --bg: #0b0d12;
      --bg-elev: rgba(255,255,255,0.06);
      --card: rgba(255,255,255,0.08);
      --card-border: rgba(255,255,255,0.12);
      --text: #eaeef8;
      --text-dim: #b8bfd0;
      --primary: #845EC2;   /* your purple */
      --success: #66B032;   /* your green */
      --accent: #00bcd4;    /* cyan accent */
      --warning: #FFD966;   /* brand yellow */
      --shadow: 0 10px 30px rgba(0,0,0,0.3);
      --radius: 16px;
      --radius-sm: 12px;
      --radius-lg: 24px;
      --blur: 10px;
      --gap: 1rem;
      --gap-lg: 1.25rem;
      --gap-xl: 2rem;
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f6f7fb;
        --bg-elev: rgba(255,255,255,0.6);
        --card: rgba(255,255,255,0.95);
        --card-border: rgba(20,23,35,0.08);
        --text: #121420;
        --text-dim: #5b6174;
        --shadow: 0 10px 25px rgba(16,24,40,0.08);
      }
    }

    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1000px 600px at 10% -10%, #1a1f2b 0%, transparent 60%),
                  radial-gradient(800px 500px at 100% 0%, #1c2634 0%, transparent 55%),
                  var(--bg);
      overflow-x: hidden;
    }
    img { display:block; max-width:100%; }

    /* ====== Layout ====== */
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1rem clamp(1rem, 3vw, 1.25rem) 3rem;
    }

    /* ====== Header / Hero ====== */
    header {
      border-radius: var(--radius-lg);
      position: relative;
      overflow: hidden;
      padding: 1.25rem;
      margin: 1rem 0 1.25rem 0;
      background: linear-gradient(145deg, rgba(132,94,194,0.85), rgba(0,188,212,0.85));
      box-shadow: var(--shadow);
      isolation: isolate;
    }
    header::after {
      content: "";
      position: absolute; inset: -20%;
      background: radial-gradient(500px 260px at 85% 20%, rgba(255,217,102,0.8), transparent 60%),
                  radial-gradient(400px 220px at 10% 80%, rgba(102,176,50,0.6), transparent 60%);
      filter: blur(40px);
      opacity: .3;
      z-index: -1;
    }
    header .row {
      display: grid;
      grid-template-columns: 110px 1fr;
      gap: var(--gap);
      align-items: center;
    }
    header img { width: 80px; height: 80px; object-fit: contain; filter: drop-shadow(0 6px 10px rgba(0,0,0,.25)); }
    .day-heading {
      margin: 0;
      font-size: clamp(1.6rem, 3.5vw, 2.2rem);
      color: #0e1014;
      font-weight: 800;
      letter-spacing: .2px;
      text-shadow: 0 1px 0 rgba(255,255,255,0.6);
    }

    .weather-wrap {
      display: grid;
      grid-template-columns: 1fr;
      gap: .25rem;
      color: #0e1014;
      font-weight: 600;
    }
    #weather.weather-content { color: #111; }
    #affirmation-box { color: #10201a; opacity: 0; transition: opacity .9s ease; }
    #affirmation-box.visible { opacity: 1; }

    /* ====== Day nav ====== */
    .day-nav {
      position: sticky; top: 0; z-index: 9;
      margin: 1rem 0 1.25rem;
      background: var(--card);
      backdrop-filter: blur(var(--blur));
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: .35rem;
      display: flex; gap: .25rem; justify-content: center; flex-wrap: wrap;
    }
    .day-nav a {
      color: var(--text);
      text-decoration: none;
      padding: .5rem .7rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: .95rem;
      letter-spacing: .2px;
      opacity: .9;
    }
    .day-nav a:hover { background: rgba(255,255,255,.12); }

    /* ====== Grid sections ====== */
    .board {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: var(--gap-lg);
    }
    .card {
      grid-column: span 12;
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(var(--blur));
      padding: clamp(1rem, 3vw, 1.25rem);
    }
    .card h2 {
      margin: 0 0 .75rem;
      font-size: 1.1rem;
      letter-spacing: .4px;
      color: var(--text-dim);
      display: flex; align-items: center; gap: .5rem;
      font-weight: 800;
      text-transform: uppercase;
    }

    /* Journals + Gratitude split on larger screens */
    #journals.card { grid-column: span 6; }
    #gratitude.card { grid-column: span 6; }

    textarea {
      width: 100%; min-height: 120px;
      resize: vertical;
      border-radius: var(--radius-sm);
      border: 1px solid var(--card-border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: .9rem 1rem;
      outline: none;
      transition: border-color .2s ease, background .2s ease, box-shadow .2s ease;
    }
    textarea:focus {
      border-color: rgba(132,94,194,.8);
      background: rgba(255,255,255,0.1);
      box-shadow: 0 0 0 4px rgba(132,94,194,.12);
    }

    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      border: 1px solid transparent;
      background: linear-gradient(180deg, var(--primary), #6f4ab5);
      color: white; padding: .65rem 1rem; border-radius: 12px;
      font-weight: 700; cursor: pointer;
      transition: transform .06s ease, box-shadow .2s ease, filter .2s ease;
      box-shadow: 0 8px 16px rgba(132,94,194,.28);
    }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }

    /* Mood Picker (emoji chips) */
    /* Keep original #mood select hidden for backward compatibility */
    #mood { display: none; }
    .mood-grid {
      display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center;
      margin-top: .5rem;
    }
    .mood-chip {
      font-size:1.4rem; padding:.5rem .6rem;
      border:1px solid var(--card-border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 12px; cursor:pointer;
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease;
    }
    .mood-chip:hover { background: rgba(255,255,255,0.12); }
    .mood-chip[aria-checked="true"] {
      outline: 2px solid var(--primary); outline-offset: 2px;
      box-shadow: 0 10px 18px rgba(132,94,194,.25);
      background: rgba(132,94,194,.2);
    }
    .mood-live { display:flex; align-items:center; gap:.5rem; justify-content:center; margin-top:.25rem; color: var(--text-dim);}
    .mood-label { font-weight: 700; letter-spacing:.2px; }

    /* Breathing */
    #breathing.card { grid-column: span 12; }
    .breathing-tile {
      display:grid; place-items:center;
      background: rgba(255,255,255,0.06);
      border:1px solid var(--card-border);
      border-radius: var(--radius);
      padding: clamp(1rem, 3vw, 1.25rem);
    }
    #breath-bubble-container { display:flex; flex-direction:column; align-items:center; gap: .75rem; }
    #breath-bubble {
      width: 120px; height: 120px; border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #8fd7ff, #008cba 70%);
      box-shadow: 0 8px 24px rgba(0,140,186,.35), inset 0 0 30px rgba(255,255,255,.25);
      will-change: transform; transform-origin:center;
    }
    #breath-text { margin:.25rem 0 .5rem; font-weight:800; color: var(--accent); }
    #breath-toggle-btn { margin-top:.25rem; }

    /* Progress Ring */
    #progress.card { grid-column: span 12; }
    .ring-wrap { display:grid; place-items:center; gap:.25rem; }
    #progress-ring { transform: rotate(-90deg); overflow:visible; }
    #progress-ring-bar { transition: stroke-dashoffset .4s ease; }
    #progress-text { text-align:center; font-weight:800; color: var(--success); }

    /* Tasks */
    #tasks.card { grid-column: span 12; }
    .task-input-group {
      display: grid; grid-template-columns: 1fr auto auto;
      gap: .5rem; align-items: center; margin-top: .75rem;
    }
    #new-task {
      width: 100%; padding: .7rem .9rem; border-radius: 12px;
      border:1px solid var(--card-border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      outline:none;
    }
    #new-task:focus { border-color: rgba(0,188,212,.8); box-shadow: 0 0 0 4px rgba(0,188,212,.15); }
    .btn-secondary {
      background: linear-gradient(180deg, #273046, #20263a);
      border-color: rgba(255,255,255,.12);
      box-shadow: 0 8px 16px rgba(0,0,0,.25);
    }

    /* Footer / Quote */
    footer {
      margin-top: var(--gap-xl);
      border-radius: var(--radius-lg);
      background: var(--card);
      border: 1px solid var(--card-border);
      backdrop-filter: blur(var(--blur));
      box-shadow: var(--shadow);
      padding: 1rem 1.25rem;
    }
    #quote-box { margin: 0; color: var(--text-dim); font-style: italic; text-align: center; }

    /* Hidden legacy compat (so main.js never crashes) */
    .compat-hidden { display:none !important; visibility:hidden !important; }

    /* Small screens tweaks */
    @media (max-width: 720px) {
      .task-input-group { grid-template-columns: 1fr 1fr; }
      .task-input-group button { width: 100%; }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- ===== Header ===== -->
    <header>
      <div class="row">
        <img src="apple-touch-icon.png" alt="App Logo">
        <div>
          <h1 id="page-title" class="day-heading"></h1>
          <div class="weather-wrap">
            <div id="weather" class="weather-content"></div>
            <div id="affirmation-box"></div>
          </div>
        </div>
      </div>
    </header>

    <!-- ===== Day nav ===== -->
    <nav class="day-nav">
      <a href="?day=Monday">Mon</a>
      <a href="?day=Tuesday">Tue</a>
      <a href="?day=Wednesday">Wed</a>
      <a href="?day=Thursday">Thu</a>
      <a href="?day=Friday">Fri</a>
      <a href="?day=Saturday">Sat</a>
      <a href="?day=Sunday">Sun</a>
    </nav>

    <!-- ===== Main board ===== -->
    <main class="board">
      <!-- Journals -->
      <section id="journals" class="card">
        <h2>📝 Journals</h2>
        <label style="display:block; font-weight:700; margin-bottom:.35rem; color:var(--text-dim)">Dream Journal</label>
        <textarea id="dream-journal" placeholder="What did you dream about?"></textarea>

        <label style="display:block; font-weight:700; margin:.9rem 0 .35rem; color:var(--text-dim)">Daily Journal</label>
        <textarea id="daily-journal" placeholder="Stream your thoughts for today…"></textarea>

        <button id="save-journal-btn" class="btn" style="margin-top:.75rem">Save Journals</button>
      </section>

      <!-- Gratitude + Mood -->
      <section id="gratitude" class="card">
        <h2>🌸 Gratitude & Mood</h2>
        <label style="display:block; font-weight:700; margin-bottom:.35rem; color:var(--text-dim)">Gratitude Prompt</label>
        <textarea id="gratitudeEntry" placeholder="What are you grateful for?"></textarea>

        <div style="margin-top:.9rem;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:.5rem;">
            <h3 style="margin:0; font-size:1rem; color:var(--text-dim); text-transform:uppercase; letter-spacing:.4px;">Your Mood</h3>
            <div class="mood-live">
              <span id="mood-emoji" style="font-size:1.4rem; opacity:.6;">—</span>
              <span id="mood-label" class="mood-label" style="opacity:.8;">How do you feel?</span>
            </div>
          </div>

          <!-- Original select kept for compatibility (hidden with CSS) -->
          <select id="mood">
            <option value="">How do you feel?</option>
            <option value="😀">Happy</option>
            <option value="😐">Neutral</option>
            <option value="😔">Sad</option>
            <option value="😤">Frustrated</option>
            <option value="😴">Tired</option>
            <option value="😌">Peaceful</option>
          </select>

          <!-- Emoji chips -->
          <div class="mood-grid" role="radiogroup" aria-label="Mood picker">
            <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😔" data-label="Sad">😔</button>
            <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😤" data-label="Frustrated">😤</button>
            <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😐" data-label="Neutral">😐</button>
            <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="🙂" data-label="Okay">🙂</button>
            <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😀" data-label="Happy">😀</button>
            <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="😌" data-label="Peaceful">😌</button>
          </div>
        </div>
      </section>

      <!-- Breathing -->
      <section id="breathing" class="card">
        <h2>🧘 Breathing Exercise</h2>
        <div class="breathing-tile">
          <div id="breath-bubble-container">
            <div id="breath-bubble"></div>
            <p id="breath-text">Inhale for <span id="countdown">4</span></p>
            <button id="breath-toggle-btn" class="btn btn-secondary">Start Breath</button>
          </div>
        </div>
      </section>

      <!-- Progress -->
      <section id="progress" class="card">
        <h2>📈 Progress</h2>
        <div class="ring-wrap">
          <svg id="progress-ring" width="150" height="150" role="img" aria-hidden="true" focusable="false">
            <circle stroke="rgba(255,255,255,0.18)" stroke-width="12" fill="transparent" r="64" cx="75" cy="75"></circle>
            <circle id="progress-ring-bar" stroke="var(--success)" stroke-width="12" fill="transparent" r="64" cx="75" cy="75" stroke-linecap="round" stroke-dasharray="402" stroke-dashoffset="402"></circle>
          </svg>
          <p id="progress-text">0% Complete</p>
        </div>
      </section>

      <!-- Tasks -->
      <section id="tasks" class="card">
        <h2>🌱 Today’s Tasks</h2>
        <div id="task-list"></div>
        <div class="task-input-group">
          <input type="text" id="new-task" placeholder="Add new task">
          <button class="btn" onclick="addTask()">Add Task</button>
          <button class="btn btn-secondary" onclick="resetTasks()">Reset All</button>
        </div>
      </section>
    </main>

    <!-- Footer Quote -->
    <footer>
      <p id="quote-box">Loading quote...</p>
    </footer>
  </div>

  <!-- ===== Legacy/compat placeholders (hidden) so older code in main.js never breaks ===== -->
  <div class="compat-hidden">
    <!-- Old rectangular progress bar some scripts may still touch -->
    <div id="progress-container"><div id="progress-bar"></div></div>
    <!-- Ongoing tasks artifacts (kept hidden) -->
    <h2 class="section-label">♾ Ongoing Tasks</h2>
    <div id="ongoing-task-list"></div>
    <div class="task-input-group">
      <input type="text" id="new-ongoing-task" placeholder="Add new ongoing task">
      <button id="add-ongoing-task-btn">Add Task</button>
      <button id="reset-ongoing-tasks-btn">Reset Ongoing Tasks</button>
    </div>
  </div>

  <!-- ===== No-op guards if any legacy functions are referenced ===== -->
  <script>
    window.addOngoingTask = window.addOngoingTask || function(){};
    window.resetOngoingTasks = window.resetOngoingTasks || function(){};
    window.updateLegacyProgress = window.updateLegacyProgress || function(pct){
      const bar = document.getElementById('progress-bar');
      if (bar) bar.style.width = (Number(pct)||0) + '%';
    };
  </script>

  <!-- ===== Progress Ring Helper (kept same API) ===== -->
  <script>
    (function () {
      const radius = 64;
      const circumference = 2 * Math.PI * radius;
      window.updateProgressCircle = function (percent) {
        const pct = Math.max(0, Math.min(100, Number(percent) || 0));
        const circle = document.getElementById('progress-ring-bar');
        if (!circle) return;
        const offset = circumference - (pct / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        const label = document.getElementById('progress-text');
        if (label) label.textContent = `${pct}% Complete`;
      };
    })();
  </script>

  <!-- ===== Mood Picker Behavior (single layout, no preselect) ===== -->
  <script>
    (function () {
      const moodSelect = document.getElementById("mood");
      const chips = Array.from(document.querySelectorAll(".mood-chip"));
      const liveEmoji = document.getElementById("mood-emoji");
      const liveLabel = document.getElementById("mood-label");

      function clearSelection() {
        chips.forEach(c => c.setAttribute("aria-checked", "false"));
        if (moodSelect) moodSelect.value = "";
        if (liveEmoji) { liveEmoji.textContent = "—"; liveEmoji.style.opacity = ".6"; }
        if (liveLabel) { liveLabel.textContent = "How do you feel?"; liveLabel.style.opacity = ".8"; }
      }
      function setSelection(emoji, label) {
        chips.forEach(c => c.setAttribute("aria-checked", c.dataset.emoji === emoji ? "true" : "false"));
        if (moodSelect) moodSelect.value = emoji;
        if (liveEmoji) { liveEmoji.textContent = emoji; liveEmoji.style.opacity = "1"; }
        if (liveLabel) { liveLabel.textContent = label; liveLabel.style.opacity = "1"; }
      }

      // init with blank (unless restored by your app)
      const prefill = moodSelect?.value || "";
      if (prefill) {
        const chip = chips.find(c => c.dataset.emoji === prefill);
        if (chip) setSelection(chip.dataset.emoji, chip.dataset.label);
        else clearSelection();
      } else {
        clearSelection();
      }

      chips.forEach(chip => {
        chip.addEventListener("click", () => setSelection(chip.dataset.emoji, chip.dataset.label));
        chip.addEventListener("keydown", (e) => {
          if (e.key === " " || e.key === "Enter") {
            e.preventDefault();
            setSelection(chip.dataset.emoji, chip.dataset.label);
          }
        });
      });
    })();
  </script>

  <!-- ===== Your app logic (weather, quote, firebase, etc.) ===== -->
  <script type="module" src="main.js"></script>
</body>
</html>
