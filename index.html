<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Daily Tasks">
  <link rel="manifest" href="/dailytaskapp/manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>Daily Task App</title>
  <style>
    html, body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0; height: 100%; width: 100%;
      background-color: #ffffff; box-sizing: border-box; overflow-x: hidden;
    }
    body { padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
    .container { max-width: 800px; margin: 0 auto; padding: 1rem; }
    header { background-color: #FFD966; padding: 1rem; margin: 0 auto 1rem auto; }
    header img { max-width: 100px; display: block; margin: 0 auto; }
    .day-heading { text-align: center; font-size: 2rem; font-weight: bold; margin: 0.50rem 0 0.25rem; color: white; visibility: visible; }
    header .weather-content {
      display: flex; flex-direction: column; align-items: center;
      text-align: center; gap: 0.25rem; font-size: 0.95rem; color: #333;
    }
    header .weather-content .temp { font-size: 1.2rem; font-weight: bold; color: #333; }
    header .weather-content .desc { font-style: italic; color: #444; }
    #affirmation-box { text-align: center; margin-top: 0.75rem; font-style: italic; color: #666; opacity: 0; transition: opacity 1.2s ease-in-out; }
    #affirmation-box.visible { opacity: 1; }
    .day-nav { text-align: center; margin-bottom: 1rem; background: #845EC2; padding: 0.5rem; border-radius: 5px; position: sticky; top: 0; z-index: 999; }
    .day-nav a { margin: 0 5px; text-decoration: none; color: white; font-weight: bold; }
    .journal-grid { background-color: white; display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center; margin-top: 2rem; }
    section#journals, section#gratitude { flex: 1 1 300px; background: #CBC3E3; padding: 1rem 1rem 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    section#journals h2, section#gratitude h2 { margin-bottom: 0.5rem; font-size: 1.25rem; font-weight: bold; color: #845EC2; }
    section#journals textarea, section#gratitude textarea { width: 100%; height: 100px; padding: 12px; margin-bottom: 1.5rem; font-family: Arial; font-size: 1rem; border-radius: 10px; border: 1px solid #bcaecf; box-sizing: border-box; resize: vertical; background: #fff; }
    section#journals button, section#gratitude button { display: block; margin: 0 auto; padding: 0.7rem 1.5rem; background-color: #845EC2; color: white; border: none; border-radius: 10px; font-size: 1rem; cursor: pointer; }
    #gratitude select { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #bcaecf; font-size: 1rem; margin-bottom: 2rem; }
    .section-label { text-align: center; font-size: 1.4rem; color: #66B032; margin: 2rem 0 1rem 0; font-weight: bold; }
    #task-list h2, #ongoing-task-list h2 { display: flex; align-items: center; gap: 10px; padding: 1rem; background: #66B032; margin-bottom: 10px; border-radius: 5px; color: white; font-weight: bold; font-size: 1.1rem; }
    .task-input-group { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 1rem 0 2rem 0; justify-content: center; max-width: 600px; }
    .task-input-group input, .task-input-group button { flex: 1 1 100%; max-width: 100%; }
    #new-task, #new-ongoing-task { width: 70%; max-width: 400px; padding: 0.6rem; font-size: 1rem; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
    button { padding: 0.6rem 1.2rem; font-size: 1rem; border-radius: 5px; background-color: #845EC2; color: white; border: none; cursor: pointer; }
    footer#quote-footer { background-color: #845EC2; padding: 1.5rem; text-align: center; color: #fff; font-style: italic; font-size: 1rem; margin: 2rem 0 0 0; width: 100%; box-sizing: border-box; }

    /* Old rectangular progress styles remain (unused) */
    #progress-container { width: 100%; background-color: #e0e0e0; border-radius: 10px; height: 20px; margin-bottom: 1rem; overflow: hidden; }
    #progress-bar { height: 100%; width: 0%; background-color: #66B032; transition: width 0.3s ease; }

    #progress-text { text-align: center; font-weight: bold; color: #4b7b2f; margin-bottom: 1.5rem; }
    .celebration-emoji { animation: pop-fade 2s ease forwards; font-size: 1.5rem; }
    @keyframes pop-fade { 0% { transform: scale(1); opacity: 1; } 30% { transform: scale(1.8); opacity: 1; } 70% { transform: scale(1.2); opacity: 0.7; } 100% { transform: scale(0.5); opacity: 0; } }

    #breath-bubble-container { display: flex; flex-direction: column; align-items: center; justify-content: center; max-width: 100%; padding: 4rem 1rem 2rem; margin: 2rem auto; text-align: center; gap: 2rem; }
    .breathing-tile { background: #CBC3E3; padding: 2rem 1.5rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); max-width: 500px; margin: 2rem auto; text-align: center; }
    #breath-bubble { width: 180px; height: 180px; background: radial-gradient(circle, #72c6ff, #008cba); border-radius: 50%; box-shadow: 0 0 20px rgba(0, 140, 186, 0.6), 0 10px 25px rgba(0, 0, 0, 0.15); transform-origin: center; display: block; margin: 0 auto 1.5rem; }
    #breath-text { font-size: 1.5rem; color: #008cba; font-weight: bold; text-align: center; margin: 2rem 0; display: flex; justify-content: center; align-items: baseline; gap: 0.4rem; }
    #breath-text span#countdown { font-size: 2rem; color: #66B032; font-weight: bold; }
    @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.5); } }
    .breathe-animation { animation: breathe 6s ease-in-out infinite; }
    #breath-toggle-btn { margin-top: 0; padding: 0.8rem 1.4rem; font-size: 1rem; border-radius: 12px; background-color: #845EC2; color: white; border: none; cursor: pointer; text-align: center; }

    /* NEW: circle progress styles */
    #progress-ring-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 1rem auto;
    }
    #progress-ring {
      transform: rotate(-90deg); /* start from 12 o'clock, fill clockwise */
      overflow: visible;
    }
    #progress-ring-bar {
      transition: stroke-dashoffset 0.4s ease;
    }

    /* ===== ADDITIONS: Mood Picker UI ===== */
    /* keep original #mood select for compatibility but hide it */
    #mood { display: none; }

    .mood-control { display: grid; gap: 0.75rem; align-items: center; }
    .mood-slider-wrap { display: grid; gap: 0.5rem; }
    #mood-slider { width: 100%; }
    .mood-scale { display: flex; justify-content: space-between; font-size: 1rem; opacity: 0.8; }
    .mood-live { display: flex; align-items: center; gap: 0.5rem; justify-content: center; }
    .mood-label { font-weight: 600; color: #333; }
    .mood-quick { display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; }
    .emoji-btn {
      font-size: 1.2rem; line-height: 1;
      padding: 0.4rem 0.55rem; border-radius: 10px; border: 1px solid #bcaecf;
      background: #fff; cursor: pointer;
    }
    .emoji-btn.active { outline: 2px solid #845EC2; outline-offset: 2px; }

    /* ===== Compact breathing bubble overrides (no removals; just overrides) ===== */
    @media (max-width: 768px) {
      #breath-bubble-container { padding: 1.25rem 1rem; gap: 1rem; }
      #breath-bubble { width: 130px; height: 130px; }
      #breath-text { margin: 0.75rem 0 0.5rem; font-size: 1.2rem; }
      .breathing-tile { padding: 1.25rem 1rem; margin: 1.2rem auto; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="apple-touch-icon.png" alt="App Logo">
      <h1 id="page-title" class="day-heading"></h1>
      <div id="weather" class="weather-content"></div>
      <div id="affirmation-box"></div>
    </header>
    <div class="day-nav">
      <a href="?day=Monday">Mon</a><a href="?day=Tuesday">Tue</a><a href="?day=Wednesday">Wed</a>
      <a href="?day=Thursday">Thu</a><a href="?day=Friday">Fri</a><a href="?day=Saturday">Sat</a><a href="?day=Sunday">Sun</a>
    </div>
    <h2 style="text-align:center; color:#008cba;">üßò Mindfulness Zone</h2>
    <div class="journal-grid">
      <section id="journals">
        <h2>Dream Journal</h2><textarea id="dream-journal"></textarea>
        <h2>Daily Journal</h2><textarea id="daily-journal"></textarea>
        <button id="save-journal-btn">Save Journals</button>
      </section>
      <section id="gratitude">
        <h2>Gratitude Prompt</h2><textarea id="gratitudeEntry"></textarea>

        <h2>Your Mood</h2>
        <!-- keep ORIGINAL select for compatibility (hidden by CSS above) -->
        <select id="mood">
          <option value="">How do you feel?</option>
          <option value="üòÄ">Happy</option>
          <option value="üòê">Neutral</option>
          <option value="üòî">Sad</option>
          <option value="üò§">Frustrated</option>
          <option value="üò¥">Tired</option>
          <option value="üòå">Peaceful</option>
        </select>

        <!-- NEW: Emoji mood picker UI -->
        <div class="mood-control" role="group" aria-label="Mood picker">
          <div class="mood-slider-wrap">
            <input id="mood-slider" type="range" min="0" max="5" step="1" value="2" aria-label="Select mood from very sad to very peaceful">
            <div class="mood-scale">
              <span>üòî</span><span>üò§</span><span>üòê</span><span>üôÇ</span><span>üòÄ</span><span>üòå</span>
            </div>
          </div>
          <div class="mood-live">
            <span id="mood-emoji" aria-live="polite" aria-atomic="true" style="font-size:2rem;">üòê</span>
            <span id="mood-label" class="mood-label">Neutral</span>
          </div>
          <div class="mood-quick">
            <button type="button" class="emoji-btn" data-index="0">üòî</button>
            <button type="button" class="emoji-btn" data-index="1">üò§</button>
            <button type="button" class="emoji-btn" data-index="2">üòê</button>
            <button type="button" class="emoji-btn" data-index="3">üôÇ</button>
            <button type="button" class="emoji-btn" data-index="4">üòÄ</button>
            <button type="button" class="emoji-btn" data-index="5">üòå</button>
          </div>
        </div>
      </section>
    </div>

    <section id="breathing">
      <h2 style="text-align:center; color:#008cba; margin:4rem 0 2rem;">Breathing Exercise</h2>
      <div class="breathing-tile">
        <div id="breath-bubble-container">
          <div id="breath-bubble"></div>
          <p id="breath-text">Inhale for <span id="countdown">4</span></p>
          <button id="breath-toggle-btn">Start Breath</button>
        </div>
      </div>
    </section>

    <h2 class="section-label">üå± Today's Tasks</h2>

    <!-- NEW: Circular Progress Ring (replaces rectangular progress bar) -->
    <div id="progress-ring-container" aria-label="Task progress">
      <svg id="progress-ring" width="140" height="140" role="img" aria-hidden="true" focusable="false">
        <circle
          id="progress-ring-bg"
          stroke="#e0e0e0"
          stroke-width="12"
          fill="transparent"
          r="60"
          cx="70"
          cy="70"
        ></circle>
        <circle
          id="progress-ring-bar"
          stroke="#66B032"
          stroke-width="12"
          fill="transparent"
          r="60"
          cx="70"
          cy="70"
          stroke-linecap="round"
          stroke-dasharray="377"
          stroke-dashoffset="377"
        ></circle>
      </svg>
    </div>

    <p id="progress-text">0% Complete</p>

    <div id="task-list"></div>
    <div class="task-input-group">
      <input type="text" id="new-task" placeholder="Add new task">
      <button onclick="addTask()">Add Task</button>
      <button onclick="resetTasks()">Reset All Tasks</button>
    </div>

    <h2 class="section-label">‚ôæ Ongoing Tasks</h2>
    <div id="ongoing-task-list"></div>
    <div class="task-input-group">
      <input type="text" id="new-ongoing-task" placeholder="Add new ongoing task">
      <button onclick="addOngoingTask()">Add Task</button>
      <button onclick="resetOngoingTasks()">Reset Ongoing Tasks</button>
    </div>

    <footer id="quote-footer"><p id="quote-box">Loading quote...</p></footer>
  </div>

  <!-- Helper so your existing logic can set percent easily -->
  <script>
    (function () {
      const radius = 60;
      const circumference = 2 * Math.PI * radius;

      // Expose a simple global for your main.js to call
      window.updateProgressCircle = function (percent) {
        const pct = Math.max(0, Math.min(100, Number(percent) || 0));
        const circle = document.getElementById('progress-ring-bar');
        if (!circle) return;
        const offset = circumference - (pct / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        const label = document.getElementById('progress-text');
        if (label) label.textContent = `${pct}% Complete`;
      };
    })();
  </script>

  <!-- ADD: Mood control behavior (keeps #mood in sync) -->
  <script>
    const MOODS = [
      { emoji: "üòî", label: "Sad" },
      { emoji: "üò§", label: "Frustrated" },
      { emoji: "üòê", label: "Neutral" },
      { emoji: "üôÇ", label: "Okay" },
      { emoji: "üòÄ", label: "Happy" },
      { emoji: "üòå", label: "Peaceful" }
    ];

    function setMoodByIndex(i) {
      const { emoji, label } = MOODS[i];
      // Update live UI
      const emojiEl = document.getElementById("mood-emoji");
      const labelEl = document.getElementById("mood-label");
      if (emojiEl) emojiEl.textContent = emoji;
      if (labelEl) labelEl.textContent = label;
      const slider = document.getElementById("mood-slider");
      if (slider) slider.value = i;
      // Write into ORIGINAL hidden select (#mood)
      const moodSelect = document.getElementById("mood");
      if (moodSelect) {
        // Ensure the value exists among options; if not, set directly
        moodSelect.value = emoji;
      }
      // Button active state
      document.querySelectorAll(".emoji-btn").forEach(btn => {
        btn.classList.toggle("active", Number(btn.dataset.index) === Number(i));
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      const slider = document.getElementById("mood-slider");
      const buttons = document.querySelectorAll(".emoji-btn");
      // Initialize from #mood (if your code pre-fills it) or default Neutral (2)
      const initialEmoji = (document.getElementById("mood")?.value) || "üòê";
      const initialIndex = Math.max(0, MOODS.findIndex(m => m.emoji === initialEmoji));
      setMoodByIndex(initialIndex === -1 ? 2 : initialIndex);

      slider?.addEventListener("input", (e) => setMoodByIndex(Number(e.target.value)));

      buttons.forEach(btn => {
        btn.addEventListener("click", () => setMoodByIndex(Number(btn.dataset.index)));
      });
    });
  </script>

  <script type="module" src="main.js"></script>
</body>
</html>
