<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Daily Tasks">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="manifest" href="manifest.json">
  <title>Daily Task App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f7f7f7;
    }
    h1 {
      text-align: center;
      background-color: #4b7eb4;
      color: white;
      padding: 1rem;
      margin: -1rem -1rem 1rem -1rem;
    }
    #task-list h2 {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0.5rem;
      background: #fff;
      margin-bottom: 5px;
      border-radius: 5px;
    }
    button {
      margin-top: 1rem;
    }
    input[type="text"] {
      width: 80%;
      padding: 0.5rem;
    }
    .day-nav {
      text-align: center;
      margin-bottom: 1rem;
    }
    .day-nav a {
      margin: 0 5px;
      text-decoration: none;
      color: #4b7eb4;
      font-weight: bold;
    }
    .delete-btn {
      margin-left: auto;
      background: none;
      border: none;
      color: red;
      font-size: 1.2rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1 id="page-title">Daily Tasks</h1>
  <div class="day-nav">
    <a href="?day=Monday">Mon</a>
    <a href="?day=Tuesday">Tue</a>
    <a href="?day=Wednesday">Wed</a>
    <a href="?day=Thursday">Thu</a>
    <a href="?day=Friday">Fri</a>
    <a href="?day=Saturday">Sat</a>
    <a href="?day=Sunday">Sun</a>
  </div>
  <div id="task-list"></div>
  <input type="text" id="new-task" placeholder="Add new task">
  <button onclick="addTask()">Add Task</button>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
    import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyAZh-tXWVRaoYIuQ9BH6z0upIuExZ8rAGs",
      authDomain: "my-daily-tasks-5a313.firebaseapp.com",
      projectId: "my-daily-tasks-5a313",
      storageBucket: "my-daily-tasks-5a313.firebasestorage.app",
      messagingSenderId: "676679892031",
      appId: "1:676679892031:web:4746c594d8415697394c8a",
      measurementId: "G-7DEQC4CWQH"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let userId = 'guest';

    signInAnonymously(auth).then(userCred => {
      userId = userCred.user.uid;
      initTaskApp();
    });

    async function saveTasks(tasks) {
      const day = getCurrentDay();
      await setDoc(doc(db, 'users', userId, day), { tasks });
    }

    async function loadTasks() {
      const day = getCurrentDay();
      const docSnap = await getDoc(doc(db, 'users', userId, day));
      if (docSnap.exists()) {
        return docSnap.data().tasks;
      }
      return getDefaultTasksForDay(day).map(text => ({ text, done: false, manual: false }));
    }

    function getCurrentDay() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('day') || new Date().toLocaleDateString('en-US', { weekday: 'long' });
    }

    async function initTaskApp() {
      const pageTitle = document.getElementById('page-title');
      const taskList = document.getElementById('task-list');
      const newTaskInput = document.getElementById('new-task');
      const day = getCurrentDay();
      pageTitle.textContent = `Tasks for ${day}`;

      let tasks = await loadTasks();

      function renderTasks() {
        taskList.innerHTML = '';
        tasks.forEach((task, index) => {
          const h2 = document.createElement('h2');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = task.done;
          checkbox.onchange = () => {
            tasks[index].done = checkbox.checked;
            saveTasks(tasks);
          };
          const span = document.createElement('span');
          span.textContent = task.text;
          h2.appendChild(checkbox);
          h2.appendChild(span);
          if (task.manual) {
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = '❌';
            deleteBtn.className = 'delete-btn';
            deleteBtn.onclick = () => {
              tasks.splice(index, 1);
              saveTasks(tasks);
              renderTasks();
            };
            h2.appendChild(deleteBtn);
          }
          taskList.appendChild(h2);
        });
      }

      window.addTask = function () {
        const text = newTaskInput.value.trim();
        if (text) {
          tasks.push({ text, done: false, manual: true });
          saveTasks(tasks);
          newTaskInput.value = '';
          renderTasks();
        }
      };

      renderTasks();
    }

    function getDefaultTasksForDay(day) {
      const taskMap = {
        Monday: ["Dream Journal", "Brush Teeth", "Take Medication", "Shower", "10 Minute Stretch", "Eat Breakfast", "5 Hour Work Day at Apple", "30 Minute Walk", "Eat Lunch", "5 Hour Work Day at Apple", "Eat Dinner", "Family Time", "15 Minute House Clean Up", "Learn Spanish", "Review Email Accounts", "Review Social Media", "Strength Train", "Shower", "Stretch", "Read a Chapter of a Book", "Journal", "Drink a Gallon of Water", "Update Planner"],
        Tuesday: ["Dream Journal", "Brush Teeth", "Take Medication", "Shower", "10 Minute Stretch", "Eat Breakfast", "5 Hour Work Day at Apple", "30 Minute Walk", "Eat Lunch", "5 Hour Work Day at Apple", "Eat Dinner", "Family Time", "15 Minute House Clean Up", "Learn Spanish", "Review Email Accounts", "Review Social Media", "Strength Train", "Shower", "Stretch", "Read a Chapter of a Book", "Journal", "Drink a Gallon of Water", "Update Planner"],
        Wednesday: ["Dream Journal", "Brush Teeth", "Take Medication", "Shower", "10 Minute Stretch", "Eat Breakfast", "30 Minute Walk", "Eat Lunch", "Pay Bills", "Check on CPAP Supplies", "Order Groceries", "2 PM Therapy Session", "Work on Alchemy Body Werks", "Eat Dinner", "Family Time", "15 Minute House Clean Up", "Learn Spanish", "Review Email Accounts", "Review Social Media", "Strength Train", "Shower", "Stretch", "Read a Chapter of a Book", "Journal", "Drink a Gallon of Water", "Update Planner"],
        Thursday: ["Dream Journal", "Brush Teeth", "Take Medication", "Shower", "10 Minute Stretch", "Eat Breakfast", "5 Hour Work Day at Apple", "30 Minute Walk", "Eat Lunch", "5 Hour Work Day at Apple", "Eat Dinner", "Family Time", "15 Minute House Clean Up", "Learn Spanish", "Review Email Accounts", "Review Social Media", "Strength Train", "Shower", "Stretch", "Read a Chapter of a Book", "Journal", "Drink a Gallon of Water", "Update Planner"],
        Friday: ["Dream Journal", "Brush Teeth", "Take Medication", "Take Out Trash", "Shower", "10 Minute Stretch", "Eat Breakfast", "5 Hour Work Day at Apple", "Call IRS to Setup Payment Plan", "30 Minute Walk", "Eat Lunch", "5 Hour Work Day at Apple", "Eat Dinner", "Finish MKG540 Module 8 Portfolio Project", "Family Time", "Find Treadmill Remote", "Find Lenovo Charger", "15 Minute House Clean Up", "Learn Spanish", "Review Email Accounts", "Review Social Media", "Strength Train", "Shower", "Stretch", "Read a Chapter of a Book", "Journal", "Drink a Gallon of Water", "Update Planner"],
        Saturday: ["Dream Journal", "Brush Teeth", "Take Medication", "Shower", "10 Minute Stretch", "Eat Breakfast", "30 Minute Walk", "Deep Clean House", "1 PM Soccer", "Eat Lunch", "Laundry", "Yard Work", "Eat Dinner", "Family Time", "Work on Alchemy Body Werks", "15 Minute House Clean Up", "Learn Spanish", "Review Email Accounts", "Review Social Media", "Strength Train", "Shower", "Stretch", "Read a Chapter of a Book", "Journal", "Drink a Gallon of Water", "Update Planner"],
        Sunday: ["Dream Journal", "Brush Teeth", "Take Medication", "Shower", "10 Minute Stretch", "Eat Breakfast", "30 Minute Walk", "CSU Homework", "Eat Lunch", "CSU Homework", "Eat Dinner", "Family Time", "15 Minute House Clean Up", "Learn Spanish", "Review Email Accounts", "Review Social Media", "Strength Train", "Shower", "Stretch", "Read a Chapter of a Book", "Journal", "Drink a Gallon of Water", "Update Planner"]
      };
      return taskMap[day] || [];
    }
  </script>
</body>
</html>
