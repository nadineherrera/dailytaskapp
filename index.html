<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0b0b10">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Daily Tasks">
  <link rel="manifest" href="/dailytaskapp/manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>Daily Task App</title>

  <!-- Optional nice font (safe fallback to system) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-1:#0b0b10;
      --bg-2:#12141d;
      --glow-1:#8f7ff5;
      --glow-2:#6ee7d2;
      --card: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.08);
      --text:#e8e8f0;
      --muted:#a7a8b3;
      --brand:#845EC2;
      --accent:#00a6d6;
      --chip:#1d2030;
      --chip-on:#23263a;
      --radius:18px;
      --shadow:0 10px 30px rgba(0,0,0,.25);
    }

    /* Animated gradient background */
    html, body {
      margin:0; padding:0; height:100%; width:100%;
      background: radial-gradient(1200px 1200px at 10% 10%, rgba(132,94,194,.25), transparent 60%),
                  radial-gradient(1200px 1200px at 90% 20%, rgba(102,176,50,.20), transparent 60%),
                  linear-gradient(160deg, var(--bg-1), var(--bg-2));
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
      overflow-x:hidden;
    }

    body { padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
    .container { max-width: 860px; margin: 0 auto; padding: clamp(16px, 3vw, 28px); }

    /* Glassy cards */
    .glass {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    /* Header */
    header {
      padding: 18px;
      margin: 0 0 16px 0;
      position: relative;
      overflow: hidden;
    }
    header:before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 180px at 50% -10%, rgba(255,255,255,.08), transparent 60%);
      pointer-events:none;
    }
    header img { width:72px; height:72px; display:block; margin: 6px auto 8px; filter: drop-shadow(0 6px 12px rgba(0,0,0,.25)); }
    .day-heading { text-align: center; font-size: clamp(1.6rem, 2.8vw, 2.2rem); font-weight: 800; margin: .4rem 0 .2rem; letter-spacing:.2px; }

    /* Weather + affirmation */
    header .weather-content { display:flex; flex-direction:column; align-items:center; gap:.25rem; font-size:.98rem; color: var(--muted); }
    header .weather-content .temp { font-size:1.1rem; font-weight:800; color: #fff; }
    header .weather-content .desc { font-style: italic; color: #d6d6df; }
    #affirmation-box { text-align:center; margin-top:.75rem; color:#d7f7ee; opacity:0; transform:translateY(4px); transition: opacity 600ms ease, transform 600ms ease; }
    #affirmation-box.visible { opacity:1; transform:translateY(0); }

    /* Day nav chips */
    .day-nav { text-align:center; margin: 8px 0 18px; position: sticky; top: 6px; z-index: 10; }
    .day-nav a {
      display:inline-block; margin: 0 4px; padding:.45rem .8rem;
      background: var(--chip); color:#e9ebff; text-decoration:none; border-radius:999px;
      border:1px solid var(--border);
      transition: transform .12s ease, background .2s ease, border-color .2s;
    }
    .day-nav a:hover { transform: translateY(-1px); background: var(--chip-on); border-color: rgba(255,255,255,.15); }

    /* Sections */
    h2.section-label {
      text-align:center; font-size: clamp(1.2rem, 2vw, 1.4rem);
      color:#bfeadf; margin: 28px 0 14px; font-weight:800; letter-spacing:.3px;
      text-shadow:0 2px 12px rgba(0,0,0,.35);
    }

    /* Journals + Gratitude */
    .journal-grid { display:flex; flex-wrap:wrap; gap:18px; justify-content:center; margin-top: 10px; }
    section#journals, section#gratitude { flex:1 1 320px; padding:16px; }
    section#journals h2, section#gratitude h2 { margin:.2rem 0 .7rem 0; font-size:1.05rem; font-weight:800; color:#e7e7ff; }

    textarea{
      width:100%; height:120px; padding:12px 14px; margin-bottom: 14px;
      border-radius: 14px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06);
      color:#f6f7ff; box-sizing:border-box; resize:vertical;
      outline:none; transition: border-color .2s, background .2s, box-shadow .2s;
    }
    textarea::placeholder{ color:#9ea2b7; }
    textarea:focus{
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.10);
      box-shadow: 0 0 0 6px rgba(143,127,245,.12);
    }

    /* Buttons */
    button, .btn {
      padding:.72rem 1.1rem; font-size:1rem; border-radius:999px; border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color:#fff; cursor:pointer; transition: transform .08s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: 0 10px 24px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.2);
      backdrop-filter: blur(6px);
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 14px 28px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.22); }
    button:active { transform: translateY(0); }
    .btn-primary{
      background: linear-gradient(135deg, rgba(143,127,245,.35), rgba(110,231,210,.25));
      border-color: rgba(143,127,245,.55);
    }

    /* Mood chips */
    .mood-grid { display:flex; flex-wrap:wrap; gap:.6rem; justify-content:center; }
    .mood-chip {
      font-size:1.45rem; padding:.5rem .7rem; border-radius:14px;
      border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); color:#fff;
      transition: transform .08s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
    }
    .mood-chip[aria-checked="true"] {
      background: linear-gradient(135deg, rgba(143,127,245,.35), rgba(110,231,210,.28));
      border-color: rgba(143,127,245,.55);
      box-shadow: 0 8px 22px rgba(143,127,245,.28);
    }
    .mood-live { display:flex; align-items:center; gap:.5rem; justify-content:center; margin-top:.4rem; color:#d6d7e3; }
    .mood-label { font-weight: 700; color: #eef; }

    /* Breathing tile */
    .breathing-tile { padding: 20px 16px; }
    #breath-bubble-container { display:flex; flex-direction:column; align-items:center; justify-content:center; max-width:100%; padding: 20px 12px 10px; text-align:center; gap: 14px; }
    #breath-bubble {
      width: 190px; height: 190px; border-radius: 50%;
      background: radial-gradient(ellipse at 30% 30%, #a3e8ff, #38bdf8 55%, #0ea5e9 100%);
      box-shadow:
        0 0 40px rgba(56,189,248,.45),
        0 20px 50px rgba(14,165,233,.22),
        inset 0 12px 40px rgba(255,255,255,.25);
      transform-origin:center; transform: scale(1);
      will-change: transform, opacity, filter;
      filter: drop-shadow(0 12px 24px rgba(0,0,0,.25));
    }
    #breath-text { font-size: 1.25rem; color: #d9fbf4; font-weight: 800; display: flex; justify-content: center; align-items: baseline; gap: .4rem; }
    #breath-text #countdown { font-size: 1.6rem; color: #b6ffe8; font-weight: 900; }
    #breath-toggle-btn { min-width: 180px; }

    /* Tasks / Ring */
    #progress-ring-container { display:flex; justify-content:center; align-items:center; margin: 1rem auto .4rem; }
    #progress-ring { transform: rotate(-90deg); overflow: visible; }
    #progress-ring defs linearGradient stop:first-child { stop-color: #8f7ff5; }
    #progress-ring defs linearGradient stop:last-child  { stop-color: #6ee7d2; }
    #progress-text { text-align:center; font-weight:800; color:#e7fff6; margin-bottom: 1.1rem; }

    #task-list { margin-top: 10px; }
    #task-list h2 { display:flex; align-items:center; gap:10px; padding:1rem; background: linear-gradient(180deg, rgba(102,176,50,.35), rgba(102,176,50,.15)); border-radius: 12px; color:#0b1b0a; font-weight: 900; }

    .task-input-group { display:flex; flex-wrap:wrap; gap:.6rem; margin: 1rem 0 2rem; justify-content:center; max-width:640px; margin-inline:auto; }
    #new-task {
      width: min(420px, 90%); padding:.7rem .9rem; font-size:1rem; border-radius: 999px;
      border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); color:#fff;
      outline:none; transition: border-color .2s, background .2s, box-shadow .2s;
    }
    #new-task:focus{ border-color: rgba(255,255,255,.24); background: rgba(255,255,255,.10); box-shadow: 0 0 0 6px rgba(110,231,210,.12); }

    /* >>> Lavender Glow task buttons (no green) <<< */
    .task-input-group button {
      background: linear-gradient(135deg, rgba(143,127,245,.45), rgba(180,160,255,.28));
      border-color: rgba(143,127,245,.65);
      color: #fff;
    }
    .task-input-group button:hover {
      box-shadow: 0 12px 26px rgba(143,127,245,.28), inset 0 1px 0 rgba(255,255,255,.25);
      transform: translateY(-1px);
    }

    /* Footer */
    footer#quote-footer { background: linear-gradient(135deg, rgba(143,127,245,.18), rgba(110,231,210,.14)); padding: 1.2rem; text-align: center; color: #eef; font-style: italic; font-size: 1rem; margin: 1.6rem 0 0 0; border-radius: var(--radius); border: 1px solid var(--border); }

    /* Hidden compat block */
    .compat-hidden { display:none !important; visibility:hidden !important; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="glass">
      <img src="apple-touch-icon.png" alt="App Logo">
      <h1 id="page-title" class="day-heading"></h1>
      <div id="weather" class="weather-content"></div>
      <div id="affirmation-box"></div>
    </header>

    <!-- Day nav -->
    <div class="day-nav">
      <a href="?day=Monday">Mon</a><a href="?day=Tuesday">Tue</a><a href="?day=Wednesday">Wed</a>
      <a href="?day=Thursday">Thu</a><a href="?day=Friday">Fri</a><a href="?day=Saturday">Sat</a><a href="?day=Sunday">Sun</a>
    </div>

    <!-- Journals + Gratitude -->
    <h2 class="section-label">ğŸ§˜ Mindfulness Zone</h2>
    <div class="journal-grid">
      <section id="journals" class="glass">
        <h2>Dream Journal</h2><textarea id="dream-journal" placeholder="What did you dream about?"></textarea>
        <h2>Daily Journal</h2><textarea id="daily-journal" placeholder="Let it flowâ€¦ even one line counts."></textarea>
        <button id="save-journal-btn" class="btn btn-primary">Save Journals</button>
      </section>

      <section id="gratitude" class="glass">
        <h2>Gratitude Prompt</h2><textarea id="gratitudeEntry" placeholder="Name one thing youâ€™re grateful for todayâ€¦"></textarea>

        <h2>Your Mood</h2>
        <select id="mood" style="display:none">
          <option value="">How do you feel?</option>
          <option value="ğŸ˜€">Happy</option>
          <option value="ğŸ˜">Neutral</option>
          <option value="ğŸ˜”">Sad</option>
          <option value="ğŸ˜¤">Frustrated</option>
          <option value="ğŸ˜´">Tired</option>
          <option value="ğŸ˜Œ">Peaceful</option>
        </select>

        <div class="mood-grid" role="radiogroup" aria-label="Mood picker">
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="ğŸ˜”" data-label="Sad">ğŸ˜”</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="ğŸ˜¤" data-label="Frustrated">ğŸ˜¤</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="ğŸ˜" data-label="Neutral">ğŸ˜</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="ğŸ™‚" data-label="Okay">ğŸ™‚</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="ğŸ˜€" data-label="Happy">ğŸ˜€</button>
          <button type="button" class="mood-chip" role="radio" aria-checked="false" data-emoji="ğŸ˜Œ" data-label="Peaceful">ğŸ˜Œ</button>
        </div>

        <div class="mood-live">
          <span id="mood-emoji" style="font-size:2rem; opacity:.8;">â€”</span>
          <span id="mood-label" class="mood-label" style="opacity:.95;">How do you feel?</span>
        </div>
      </section>
    </div>

    <!-- Breathing -->
    <section id="breathing">
      <h2 class="section-label">Breathing Exercise</h2>
      <div class="glass breathing-tile">
        <div id="breath-bubble-container">
          <div id="breath-bubble"></div>
          <p id="breath-text">Inhale for <span id="countdown">4</span></p>
          <button id="breath-toggle-btn" class="btn btn-primary">Start Breath</button>
        </div>
      </div>
    </section>

    <!-- Tasks -->
    <h2 class="section-label">ğŸŒ± Todayâ€™s Tasks</h2>
    <div class="glass" style="padding:16px; margin-bottom:14px;">
      <div id="progress-ring-container" aria-label="Task progress">
        <svg id="progress-ring" width="160" height="160">
          <defs>
            <linearGradient id="ringGrad" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#8f7ff5"></stop>
              <stop offset="100%" stop-color="#6ee7d2"></stop>
            </linearGradient>
          </defs>
          <circle stroke="rgba(255,255,255,.12)" stroke-width="14" fill="transparent" r="70" cx="80" cy="80"></circle>
          <circle id="progress-ring-bar" stroke="url(#ringGrad)" stroke-width="14" fill="transparent" r="70" cx="80" cy="80" stroke-linecap="round" stroke-dasharray="439.8" stroke-dashoffset="439.8"></circle>
        </svg>
      </div>
      <p id="progress-text">0% Complete</p>

      <div id="task-list"></div>
      <div class="task-input-group">
        <input type="text" id="new-task" placeholder="Add new task">
        <button onclick="addTask()" class="btn">Add Task</button>
        <button onclick="resetTasks()" class="btn">Reset All Tasks</button>
      </div>
    </div>

    <!-- Footer -->
    <footer id="quote-footer" class="glass"><p id="quote-box">Loading quote...</p></footer>
  </div>

  <!-- Hidden compat placeholders to avoid errors if legacy code calls them -->
  <div class="compat-hidden">
    <div id="progress-container"><div id="progress-bar"></div></div>
    <h2 class="section-label">â™¾ Ongoing Tasks</h2>
    <div id="ongoing-task-list"></div>
    <div class="task-input-group">
      <input type="text" id="new-ongoing-task" placeholder="Add new ongoing task">
      <button id="add-ongoing-task-btn">Add Task</button>
      <button id="reset-ongoing-tasks-btn">Reset Ongoing Tasks</button>
    </div>
  </div>

  <!-- No-op guards -->
  <script>
    window.addOngoingTask = window.addOngoingTask || function(){};
    window.resetOngoingTasks = window.resetOngoingTasks || function(){};
    window.updateLegacyProgress = window.updateLegacyProgress || function(pct){
      const bar = document.getElementById('progress-bar');
      if (bar) bar.style.width = (Number(pct)||0) + '%';
    };
  </script>

  <!-- Progress ring helper (unchanged API) -->
  <script>
    (function () {
      const radius = 70;
      const circumference = 2 * Math.PI * radius;
      window.updateProgressCircle = function (percent) {
        const pct = Math.max(0, Math.min(100, Number(percent) || 0));
        const circle = document.getElementById('progress-ring-bar');
        if (!circle) return;
        const offset = circumference - (pct / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        const label = document.getElementById('progress-text');
        if (label) label.textContent = `${pct}% Complete`;
      };
    })();
  </script>

  <!-- Mood control behavior (unchanged logic) -->
  <script>
    (function () {
      const moodSelect = document.getElementById("mood");
      const chips = Array.from(document.querySelectorAll(".mood-chip"));
      const liveEmoji = document.getElementById("mood-emoji");
      const liveLabel = document.getElementById("mood-label");

      function clearSelection() {
        chips.forEach(c => c.setAttribute("aria-checked", "false"));
        if (moodSelect) moodSelect.value = "";
        if (liveEmoji) { liveEmoji.textContent = "â€”"; liveEmoji.style.opacity = ".6"; }
        if (liveLabel) { liveLabel.textContent = "How do you feel?"; liveLabel.style.opacity = ".9"; }
      }
      function setSelection(emoji, label) {
        chips.forEach(c => c.setAttribute("aria-checked", c.dataset.emoji === emoji ? "true" : "false"));
        if (moodSelect) moodSelect.value = emoji;
        if (liveEmoji) { liveEmoji.textContent = emoji; liveEmoji.style.opacity = "1"; }
        if (liveLabel) { liveLabel.textContent = label; liveLabel.style.opacity = "1"; }
      }

      const prefill = moodSelect?.value || "";
      if (prefill) {
        const chip = chips.find(c => c.dataset.emoji === prefill);
        if (chip) setSelection(chip.dataset.emoji, chip.dataset.label);
        else clearSelection();
      } else {
        clearSelection();
      }

      chips.forEach(chip => {
        chip.addEventListener("click", () => setSelection(chip.dataset.emoji, chip.dataset.label));
        chip.addEventListener("keydown", (e) => {
          if (e.key === " " || e.key === "Enter") {
            e.preventDefault();
            setSelection(chip.dataset.emoji, chip.dataset.label);
          }
        });
      });
    })();
  </script>

  <!-- Smooth breathing module (unchanged API, modern look) -->
  <script>
    (function(){
      const bubble = document.getElementById('breath-bubble');
      const label  = document.getElementById('breath-text');
      const counter= document.getElementById('countdown');
      const btn    = document.getElementById('breath-toggle-btn');

      const PROTOCOLS = {
        BOX_4_4_4_4: [
          { name: 'Inhale', seconds: 4, targetScale: 1.45 },
          { name: 'Hold',   seconds: 4, targetScale: 1.45 },
          { name: 'Exhale', seconds: 4, targetScale: 1.00 },
          { name: 'Hold',   seconds: 4, targetScale: 1.00 },
        ],
        COHERENT_6BPM: [
          { name: 'Inhale', seconds: 5, targetScale: 1.45 },
          { name: 'Exhale', seconds: 5, targetScale: 1.00 },
        ]
      };
      let ACTIVE = PROTOCOLS.BOX_4_4_4_4; // default

      const easeInOut = (t)=> t<0.5 ? 2*t*t : 1 - Math.pow(-2*t+2,2)/2;
      const roundSec  = (ms)=> Math.max(0, Math.ceil(ms/1000));

      let running=false, stepIdx=0, rafId=null, stepStart=0, currScale=1;

      function setScale(s){
        currScale = s;
        bubble.style.transform = `scale(${s})`;
        const glow = 0.25 + (s-1)*0.7;
        bubble.style.filter = `drop-shadow(0 12px 24px rgba(0,0,0,.25))`;
        bubble.style.boxShadow =
          `0 0 ${40 + (s-1)*60}px rgba(56,189,248,${.35+glow/4}),
           0 20px ${50 + (s-1)*40}px rgba(14,165,233,${.18+glow/5}),
           inset 0 12px ${40 + (s-1)*30}px rgba(255,255,255,${.18+glow/6})`;
      }

      function tick(now){
        const step = ACTIVE[stepIdx];
        const durMs = step.seconds * 1000;
        const elapsed = now - stepStart;
        const t = Math.min(1, elapsed / durMs);

        const prev = ACTIVE[(stepIdx - 1 + ACTIVE.length) % ACTIVE.length];
        const startScale = (stepIdx === 0 && prev) ? prev.targetScale : currScale;
        const endScale   = step.targetScale;

        const eased = (step.name === 'Hold') ? 1 : easeInOut(t);
        const s = startScale + (endScale - startScale) * eased;
        setScale(s);

        const remain = Math.max(0, durMs - elapsed);
        const sec = roundSec(remain);
        label.firstChild.nodeValue = `${step.name} for `;
        if (counter) counter.textContent = String(sec);

        if (elapsed >= durMs) {
          stepIdx = (stepIdx + 1) % ACTIVE.length;
          stepStart = now;
        }
        if (running) rafId = requestAnimationFrame(tick);
      }

      function start(){
        if (running) return;
        running = true;
        btn.textContent = 'Stop Breath';
        stepIdx = 0;
        stepStart = performance.now();
        const tf = window.getComputedStyle(bubble).transform;
        if (tf === 'none') setScale(1);
        rafId = requestAnimationFrame(tick);
      }

      function stop(){
        running = false;
        btn.textContent = 'Start Breath';
        if (rafId) cancelAnimationFrame(rafId);
        rafId = null;
        label.firstChild.nodeValue = 'Inhale for ';
        if (counter) counter.textContent = '4';
        setScale(1);
      }

      btn.addEventListener('click', ()=> running ? stop() : start());

      // Long-press to toggle protocol (keeps UI minimal)
      let pressTimer;
      btn.addEventListener('mousedown', ()=> {
        pressTimer = setTimeout(()=>{
          ACTIVE = (ACTIVE === PROTOCOLS.BOX_4_4_4_4) ? PROTOCOLS.COHERENT_6BPM : PROTOCOLS.BOX_4_4_4_4;
          const name = (ACTIVE === PROTOCOLS.COHERENT_6BPM) ? 'Coherent (6 bpm)' : 'Box (4-4-4-4)';
          btn.title = `Mode: ${name}`;
        }, 700);
      });
      ['mouseup','mouseleave','touchend','touchcancel'].forEach(evt=>{
        btn.addEventListener(evt, ()=> clearTimeout(pressTimer));
      });
    })();
  </script>

  <!-- Your app logic -->
  <script type="module" src="main.js"></script>
</body>
</html>
