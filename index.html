<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Daily Tasks">
  <link rel="manifest" href="/dailytaskapp/manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>Daily Task App</title>
  <style>
    :root{
      --brand-purple:#845EC2;
      --brand-green:#66B032;
      --accent:#008cba;
      --yellow:#FFD966;
      --text:#222;
      --muted:#666;
      --bg:#f7f7fb;
      --card:#fff;
      --radius:14px;
      --shadow:0 6px 20px rgba(0,0,0,.08);
      --border:#e7e7ef;
    }
    html, body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0; padding: 0; height: 100%; width: 100%;
      background: var(--bg);
      color: var(--text);
      box-sizing: border-box; overflow-x: hidden;
    }
    body { padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
    .container { max-width: 980px; margin: 0 auto; padding: 1rem; }

    /* Header */
    header {
      background: var(--yellow);
      padding: 1rem 1.25rem;
      margin: 0 auto 1.25rem auto;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    header img { max-width: 80px; display:block; margin: 0 auto; }
    .day-heading { text-align: center; font-size: 1.9rem; font-weight: 800; margin: .5rem 0 .25rem; color: #000; }
    header .weather-content { display: flex; flex-direction: column; align-items: center; text-align: center; gap: 0.25rem; font-size: 0.95rem; color: #333; }
    header .weather-content .temp { font-size: 1.1rem; font-weight: 700; }
    header .weather-content .desc { font-style: italic; color: #444; }
    #affirmation-box { text-align: center; margin-top: .5rem; font-style: italic; color: var(--muted); opacity: 0; transition: opacity .8s ease; }
    #affirmation-box.visible { opacity: 1; }

    /* Day nav */
    .day-nav { display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center; margin-bottom: 1.25rem; }
    .day-nav a { text-decoration:none; color:#fff; background: var(--brand-purple); padding:.5rem .8rem; border-radius: 999px; font-weight:700; font-size:.95rem; transition: filter .15s ease; }
    .day-nav a:hover { filter: brightness(1.05); }

    /* Section labels */
    .section-label { text-align: center; font-size: 1.25rem; color: var(--brand-green); margin: 1.75rem 0 1rem; font-weight: 800; }

    /* Journals + Gratitude cards */
    .journal-grid { display: flex; flex-wrap: wrap; gap: 1.5rem; justify-content: center; align-items: stretch; margin-top: 1rem; }
    section#journals, section#gratitude {
      flex: 1 1 320px; display:flex; flex-direction:column;
      background: var(--card); padding: 1.25rem;
      border-radius: var(--radius); box-shadow: var(--shadow); border:1px solid var(--border);
    }
    section#journals h2, section#gratitude h2 { margin: 0 0 .6rem; font-size: 1.1rem; font-weight: 800; color: var(--brand-purple); }
    section#journals textarea, section#gratitude textarea { flex:1; min-height:100px; margin-bottom:1rem; padding: 12px; font-size: 1rem; border-radius: 10px; border: 1px solid #d9d9e3; }
    section#journals button, section#gratitude button {
      margin-top:auto; align-self:center; padding:0.65rem 1.2rem;
      background: var(--brand-purple); color:#fff; border:none; border-radius:8px; font-weight:700;
      cursor:pointer; box-shadow:0 4px 10px rgba(132,94,194,.25);
    }

    /* Mood Picker */
    #mood { display: none; }
    .mood-grid { display:flex; flex-wrap:wrap; gap:0.6rem; justify-content:center; margin-top:0.5rem; }
    .mood-chip { font-size:1.4rem; padding:0.4rem 0.6rem; border-radius:10px; border:1px solid #d9d9e3; background:#fff; cursor:pointer; transition:all .15s ease; }
    .mood-chip:hover { background:#f5f1ff; }
    .mood-chip[aria-checked="true"] { outline:2px solid var(--brand-purple); background:#f0eaff; }
    .mood-live { margin-top:0.6rem; text-align:center; font-size:0.95rem; color:#555; }
    #mood-emoji { font-size:1.5rem; }

    /* Breathing */
    #breathing .breathing-tile { background: var(--card); padding: 1.25rem 1rem; border-radius: var(--radius); box-shadow: var(--shadow); border:1px solid var(--border); max-width: 520px; margin: 1.25rem auto; }
    #breath-bubble-container { display:flex; flex-direction:column; align-items:center; gap:1rem; }
    #breath-bubble { width:140px; height:140px; background: radial-gradient(circle, #8fd7ff, var(--accent)); border-radius: 50%; box-shadow: 0 0 16px rgba(0,140,186,.35), 0 8px 20px rgba(0,0,0,.08); transform-origin:center; margin-bottom:.5rem; }
    #breath-text { font-size: 1.2rem; color: var(--accent); font-weight: 800; display:flex; gap:0.4rem; }
    #breath-text span#countdown { font-size: 1.6rem; color: var(--brand-green); }
    @keyframes breathe { 0%,100% { transform: scale(1); } 50% { transform: scale(1.5); } }
    .breathe-animation { animation: breathe 6s ease-in-out infinite; }
    #breath-toggle-btn { padding:0.7rem 1.1rem; font-size:1rem; border-radius:10px; background:var(--brand-purple); color:#fff; border:none; cursor:pointer; font-weight:700; }

    /* Progress ring + tasks */
    #progress-ring-card { background: var(--card); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); padding: 1rem; margin: 1rem auto; max-width: 520px; }
    #progress-ring-container { display:flex; justify-content:center; align-items:center; margin:.5rem auto; }
    #progress-ring { transform:rotate(-90deg); }
    #progress-ring-bar { transition: stroke-dashoffset 0.4s ease; }
    #progress-text { text-align:center; font-weight:800; color:var(--brand-green); margin-bottom:.5rem; }
    #task-card { background: var(--card); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); padding: 1rem; margin-top:.75rem; }
    .task-input-group { display:flex; flex-wrap:wrap; gap:0.5rem; margin-top:1rem; justify-content:center; }
    #new-task { flex:1; min-width:200px; padding:0.65rem; font-size:1rem; border-radius:10px; border:1px solid #d9d9e3; }
    button { padding:0.6rem 1.1rem; border-radius:10px; font-weight:700; }
    button.secondary { background: var(--accent); color:#fff; }

    /* Footer */
    footer#quote-footer { background: var(--card); padding: 1rem; text-align: center; color: var(--muted); font-style: italic; font-size: 1rem; margin: 1.5rem 0 0; border-radius: var(--radius); border:1px solid var(--border); box-shadow: var(--shadow); }

    .compat-hidden { display:none !important; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="apple-touch-icon.png" alt="App Logo">
      <h1 id="page-title" class="day-heading"></h1>
      <div id="weather" class="weather-content"></div>
      <div id="affirmation-box"></div>
    </header>

    <div class="day-nav">
      <a href="?day=Monday">Mon</a><a href="?day=Tuesday">Tue</a><a href="?day=Wednesday">Wed</a>
      <a href="?day=Thursday">Thu</a><a href="?day=Friday">Fri</a><a href="?day=Saturday">Sat</a><a href="?day=Sunday">Sun</a>
    </div>

    <h2 class="section-label">üßò Mindfulness Zone</h2>
    <div class="journal-grid">
      <section id="journals">
        <h2>Journals</h2>
        <label for="dream-journal">Dream Journal</label>
        <textarea id="dream-journal" placeholder="What did you dream about?"></textarea>
        <label for="daily-journal">Daily Journal</label>
        <textarea id="daily-journal" placeholder="Stream your thoughts‚Ä¶"></textarea>
        <button id="save-journal-btn">Save Journals</button>
      </section>

      <section id="gratitude">
        <h2>Gratitude & Mood</h2>
        <label for="gratitudeEntry">Gratitude Prompt</label>
        <textarea id="gratitudeEntry" placeholder="What are you grateful for today?"></textarea>

        <h3 style="margin:.75rem 0 .25rem;">Your Mood</h3>
        <select id="mood"><option value="">How do you feel?</option><option value="üòÄ">Happy</option><option value="üòê">Neutral</option><option value="üòî">Sad</option><option value="üò§">Frustrated</option><option value="üò¥">Tired</option><option value="üòå">Peaceful</option></select>
        <div class="mood-grid" role="radiogroup">
          <button class="mood-chip" data-emoji="üòî" data-label="Sad">üòî</button>
          <button class="mood-chip" data-emoji="üò§" data-label="Frustrated">üò§</button>
          <button class="mood-chip" data-emoji="üòê" data-label="Neutral">üòê</button>
          <button class="mood-chip" data-emoji="üôÇ" data-label="Okay">üôÇ</button>
          <button class="mood-chip" data-emoji="üòÄ" data-label="Happy">üòÄ</button>
          <button class="mood-chip" data-emoji="üòå" data-label="Peaceful">üòå</button>
        </div>
        <div class="mood-live"><span id="mood-emoji">‚Äî</span><span id="mood-label">How do you feel?</span></div>
      </section>
    </div>

    <h2 class="section-label">ü´Å Breathing Exercise</h2>
    <div class="breathing-tile">
      <div id="breath-bubble-container">
        <div id="breath-bubble"></div>
        <p id="breath-text">Inhale for <span id="countdown">4</span></p>
        <button id="breath-toggle-btn">Start Breath</button>
      </div>
    </div>

    <h2 class="section-label">üå± Today's Tasks</h2>
    <div id="progress-ring-card">
      <div id="progress-ring-container">
        <svg id="progress-ring" width="140" height="140">
          <circle id="progress-ring-bg" stroke="#e9e9f2" stroke-width="12" fill="transparent" r="60" cx="70" cy="70"></circle>
          <circle id="progress-ring-bar" stroke="var(--brand-green)" stroke-width="12" fill="transparent" r="60" cx="70" cy="70" stroke-linecap="round" stroke-dasharray="377" stroke-dashoffset="377"></circle>
        </svg>
      </div>
      <p id="progress-text">0% Complete</p>
    </div>

    <div id="task-card">
      <div id="task-list"></div>
      <div class="task-input-group">
        <input type="text" id="new-task" placeholder="Add new task">
        <button onclick="addTask()">Add Task</button>
        <button class="secondary" onclick="resetTasks()">Reset All Tasks</button>
      </div>
    </div>

    <footer id="quote-footer"><p id="quote-box">Loading quote...</p></footer>
  </div>

  <!-- Helpers -->
  <script>
    // Safe guards so main.js never breaks
    window.addOngoingTask = () => {};
    window.resetOngoingTasks = () => {};
    window.updateLegacyProgress = pct => {
      const bar=document.getElementById('progress-bar');
      if(bar) bar.style.width=(Number(pct)||0)+'%';
    };
  </script>
  <script>
    // Progress ring helper
    (function () {
      const radius = 60;
      const circumference = 2 * Math.PI * radius;
      window.updateProgressCircle = function (percent) {
        const pct = Math.max(0, Math.min(100, Number(percent) || 0));
        const circle = document.getElementById('progress-ring-bar');
        if (!circle) return;
        const offset = circumference - (pct / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        document.getElementById('progress-text').textContent = `${pct}% Complete`;
      };
    })();
  </script>
  <script>
    // Mood control
    (function () {
      const moodSelect=document.getElementById("mood");
      const chips=[...document.querySelectorAll(".mood-chip")];
      const liveEmoji=document.getElementById("mood-emoji");
      const liveLabel=document.getElementById("mood-label");
      function clearSel(){chips.forEach(c=>c.setAttribute("aria-checked","false"));moodSelect.value="";liveEmoji.textContent="‚Äî";liveLabel.textContent="How do you feel?";}
      function setSel(e,l){chips.forEach(c=>c.setAttribute("aria-checked",c.dataset.emoji===e?"true":"false"));moodSelect.value=e;liveEmoji.textContent=e;liveLabel.textContent=l;}
      clearSel();
      chips.forEach(chip=>{chip.addEventListener("click",()=>setSel(chip.dataset.emoji,chip.dataset.label));});
    })();
  </script>
  <script type="module" src="main.js"></script>
</body>
</html>
